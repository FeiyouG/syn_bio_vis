import React, { useState } from 'react';
import ReactMarkdown from 'react-markdown';
import { useDispatch } from 'react-redux';

import { getTutorial } from '../../actions/tutorial';
import { getSim } from '../../actions/simulation';
import SDSimulation from '../d3/SDSimulation'

function Tutorial() {
  // MARK: hooks
  const [tutorial, setTutorial] = useState("# This is Lesson page");
  const [simData, setSimData] = useState({
    message: "Waiting for server ..."
  });
  const dispatch = useDispatch();

  // MAKR: local functions
  const handleGetTutorial = (e) => {
    e.preventDefault(); // Avoid refreshing automatically on submit
    dispatch(getTutorial("Lesson" + e.target.id, setTutorial));
    handleGetSim("example", setSimData)
  }

  const handleGetSim = (simName, setSimData) => {
    dispatch(getSim(simName, setSimData))
  }

  // const handleGetSim = async (simName, setSimData) => {
  //   dispatch(getSim(simName, setSimData))
  // }

  const codeblockRender = ({ inline, className, children, ...props }) => {
    if (inline) return <code>{children}</code>

    const language = className.split("-")[1]

    if (language == "SDSimulation") {
      return SDSimulationRender({ inline, className, children, props })
    }
    return <pre><code className={className}>{children}</code></pre>

  }

  const SDSimulationRender = ({ inline, className, children, ...props }) => {
    const content = JSON.parse(children)
    if (content.name != 'undefined') {     // has pre-defined simulation data
      // var simData =
      // {
      //   "strands": [
      //     "AGATAGCTGA",
      //     "TCTATCGACT"
      //   ],
      //   "conformation": [
      //     "......((((+))))((((((+))))))",
      //     "......((((+)))).((((.+.)))).",
      //     "......((((+)))).((((.+.)))).",
      //     "......(((.+.)))..(((.+.)))..",
      //     "......(((.+.))).(((((+))))).",
      //     ".....(((((+)))))(((((+))))).",
      //     "........((+))..((((((+))))))",
      //     ".....(((((+)))))(((((+))))).",
      //     ".....(((((+)))))(((((+))))).",
      //     ".......(((+)))..(((((+))))).",
      //     ".....((((.+.))))((((.+.)))).",
      //     "........(.+.)..(((((.+.)))))",
      //     ".......((.+.)).((((((+))))))",
      //     ".......((.+.)).((((((+))))))",
      //     "......(((.+.)))..(((.+.)))..",
      //     ".....((((.+.))))((((.+.)))).",
      //     ".........(+)...(((((.+.)))))",
      //     ".......(((+))).(((((.+.)))))",
      //     ".......((.+.))..((((.+.)))).",
      //     "........(.+.)..(((((.+.)))))",
      //     "......((..+..))((((((+))))))",
      //     "......(((.+.))).(((((+))))).",
      //     "......(((.+.)))(((((.+.)))))",
      //     "......(((.+.))).(((((+))))).",
      //     "......(((.+.))).(((((+))))).",
      //     "......(((.+.))).(((((+))))).",
      //     "......(((.+.)))(((((.+.)))))",
      //     "....(((((.+.)))))..(.+.)....",
      //     "...(((((((+)))))))..(+).....",
      //     ".((((((((.+.)))))))). ......",
      //     ".((((((.((+)).)))))). ......",
      //     ".((((((((.+.)))))))). ......",
      //     ".((((((((.+.)))))))). ......",
      //     ".((((((((.+.)))))))). ......",
      //     "((.((((((.+.)))))).)) ......",
      //     "((((((((((+)))))))))) ......",
      //     "((((((((((+)))))))))) ......",
      //     ".((((((((.+.)))))))). ......",
      //     "((((((((((+)))))))))) ......",
      //     ".((((((...+...)))))). ......",
      //     ".((((((((.+.)))))))). ......",
      //     "((((((((((+)))))))))) ......",
      //     ".((((((((.+.)))))))). ......",
      //     "((((((((..+..)))))))) ......",
      //     ".((((((((.+.)))))))). ......",
      //     ".((((((((.+.)))))))). ......",
      //     ".((((((((.+.)))))))). ......",
      //     "((((((((((+)))))))))) ......",
      //     "(((((((.(.+.).))))))) ......",
      //     "((((((((((+)))))))))) ......",
      //     ".((((((((.+.)))))))). ......",
      //     "((((((((((+)))))))))) ......",
      //     "((((((((((+)))))))))) ......",
      //     "((((.((((.+.)))).)))) ......",
      //     "((((((((((+)))))))))) ......",
      //     "((((((((((+)))))))))) ......",
      //     ".(((.(((((+))))).))). ......",
      //     "((((((((((+)))))))))) ......",
      //     ".((((.((((+)))).)))). ......",
      //     "(((((.(((.+.))).))))) ......",
      //     "((((((((..+..)))))))) ......",
      //     "((((((((..+..)))))))) ......",
      //     ".((((((((.+.)))))))). ......",
      //     ".((((((((.+.)))))))). ......",
      //     "((((((((..+..)))))))) ......",
      //     "((((((((((+)))))))))) ......",
      //     "((((((((((+)))))))))) ......",
      //     ".((((((((.+.)))))))). ......",
      //     ".((((((((.+.)))))))). ......",
      //     ".((((((((.+.)))))))). ......",
      //     "(((((.(((.+.))).))))) ......",
      //     "...((((((.+.))))))... ......",
      //     ".((((((((.+.)))))))). ......",
      //     "((((((((((+)))))))))) ......",
      //     "((((((((((+)))))))))) ......",
      //     ".((((((((.+.)))))))). ......",
      //     ".((((((((.+.)))))))). ......",
      //     "((((((((((+)))))))))) ......",
      //     "...((((((.+.))))))... ......",
      //     ".((((((((.+.)))))))). ......",
      //     ".((((((((.+.)))))))). ......",
      //     ".((((((((.+.)))))))). ......",
      //     ".((((.((((+)))).)))). ......",
      //     ".((((((((.+.)))))))). ......",
      //     ".(((((((.(+).))))))). ......",
      //     "((((((.((.+.)).)))))) ......",
      //     ".((((((((.+.)))))))). ......",
      //     "(((((((.(.+.).))))))) ......",
      //     "(((((.(((.+.))).))))) ......",
      //     ".((((((((.+.)))))))). ......",
      //     ".((((((((.+.)))))))). ......",
      //     ".((((((...+...)))))). ......",
      //     ".((((((...+...)))))). ......",
      //     ".((((((((.+.)))))))). ......",
      //     "((((((((((+)))))))))) ......",
      //     ".((((((((.+.)))))))). ......",
      //     ".((((((((.+.)))))))). ......",
      //     ".((((((((.+.)))))))). ......",
      //     "...((((((.+.))))))... ......",
      //     "((((((((((+)))))))))) ......",
      //     "((((((((((+)))))))))) ......",
      //     "((((((((((+)))))))))) ......",
      //     "((((((((((+)))))))))) ......",
      //     ".((((((((.+.)))))))). ......",
      //     ".((((((((.+.)))))))). ......"
      //   ],
      //   "energy": [
      //     20.999572362025956,
      //     9.879572362025955,
      //     9.879572362025955,
      //     13.079572362025953,
      //     9.499572362025955,
      //     9.329572362025957,
      //     10.709572362025956,
      //     9.329572362025957,
      //     9.329572362025957,
      //     9.639572362025955,
      //     9.209572362025956,
      //     10.589572362025955,
      //     9.619572362025956,
      //     9.619572362025956,
      //     13.079572362025953,
      //     9.209572362025956,
      //     12.479572362025955,
      //     9.999572362025956,
      //     9.519572362025954,
      //     10.589572362025955,
      //     12.549572362025955,
      //     9.499572362025955,
      //     9.879572362025955,
      //     9.499572362025955,
      //     9.499572362025955,
      //     9.499572362025955,
      //     9.879572362025955,
      //     12.649572362025953,
      //     12.059572362025957,
      //     -1.0752138189870202,
      //     2.0347861810129793,
      //     -1.0752138189870202,
      //     -1.0752138189870202,
      //     -1.0752138189870202,
      //     2.5347861810129775,
      //     -0.9552138189870192,
      //     -0.9552138189870192,
      //     -1.0752138189870202,
      //     -0.9552138189870192,
      //     1.1447861810129787,
      //     -1.0752138189870202,
      //     -0.9552138189870192,
      //     -1.0752138189870202,
      //     1.5947861810129815,
      //     -1.0752138189870202,
      //     -1.0752138189870202,
      //     -1.0752138189870202,
      //     -0.9552138189870192,
      //     1.6547861810129803,
      //     -0.9552138189870192,
      //     -1.0752138189870202,
      //     -0.9552138189870192,
      //     -0.9552138189870192,
      //     3.264786181012978,
      //     -0.9552138189870192,
      //     -0.9552138189870192,
      //     3.6447861810129787,
      //     -0.9552138189870192,
      //     2.3547861810129795,
      //     1.974786181012977,
      //     1.5947861810129815,
      //     1.5947861810129815,
      //     -1.0752138189870202,
      //     -1.0752138189870202,
      //     1.5947861810129815,
      //     -0.9552138189870192,
      //     -0.9552138189870192,
      //     -1.0752138189870202,
      //     -1.0752138189870202,
      //     -1.0752138189870202,
      //     1.974786181012977,
      //     1.264786181012978,
      //     -1.0752138189870202,
      //     -0.9552138189870192,
      //     -0.9552138189870192,
      //     -1.0752138189870202,
      //     -1.0752138189870202,
      //     -0.9552138189870192,
      //     1.264786181012978,
      //     -1.0752138189870202,
      //     -1.0752138189870202,
      //     -1.0752138189870202,
      //     2.3547861810129795,
      //     -1.0752138189870202,
      //     2.754786181012979,
      //     1.2547861810129781,
      //     -1.0752138189870202,
      //     1.6547861810129803,
      //     1.974786181012977,
      //     -1.0752138189870202,
      //     -1.0752138189870202,
      //     1.1447861810129787,
      //     1.1447861810129787,
      //     -1.0752138189870202,
      //     -0.9552138189870192,
      //     -1.0752138189870202,
      //     -1.0752138189870202,
      //     -1.0752138189870202,
      //     1.264786181012978,
      //     -0.9552138189870192,
      //     -0.9552138189870192,
      //     -0.9552138189870192,
      //     -0.9552138189870192,
      //     -1.0752138189870202,
      //     -1.0752138189870202
      //   ],
      //   "time": [
      //     0.0,
      //     1.3777287513428606e-07,
      //     2.5293141122227776e-07,
      //     3.649222387798077e-07,
      //     4.919134460906206e-07,
      //     6.137006777284282e-07,
      //     7.361303622589032e-07,
      //     8.75441668140903e-07,
      //     9.820459612694137e-07,
      //     1.1241025587480098e-06,
      //     1.260947564245725e-06,
      //     1.377659616767231e-06,
      //     1.4922262011963608e-06,
      //     1.6280762108614768e-06,
      //     1.7767770788657887e-06,
      //     1.911031273168336e-06,
      //     2.0591073314905175e-06,
      //     2.205858827694787e-06,
      //     2.3359765529047153e-06,
      //     2.4863311359562377e-06,
      //     2.612635070123671e-06,
      //     2.7371676154703796e-06,
      //     2.8561350557859973e-06,
      //     2.971968876138715e-06,
      //     3.0995950891429027e-06,
      //     3.247258634130087e-06,
      //     3.35405958786806e-06,
      //     3.499542959198395e-06,
      //     3.63539235131952e-06,
      //     3.874291256429038e-06,
      //     4.142073906587786e-06,
      //     4.376441791219163e-06,
      //     4.603614915963496e-06,
      //     4.823989403031879e-06,
      //     5.066873078884211e-06,
      //     5.248802424135559e-06,
      //     5.492795282722769e-06,
      //     5.724483019274801e-06,
      //     5.957689739713869e-06,
      //     6.126070247111477e-06,
      //     6.344193935936988e-06,
      //     6.538688201276961e-06,
      //     6.791086394666315e-06,
      //     7.0333003044440506e-06,
      //     7.251429648848891e-06,
      //     7.449953668692944e-06,
      //     7.688103876777998e-06,
      //     7.92068360120888e-06,
      //     8.200169201445914e-06,
      //     8.39106125124488e-06,
      //     8.57224145583855e-06,
      //     8.831926532248147e-06,
      //     9.006016201504707e-06,
      //     9.233426022335097e-06,
      //     9.45757347925157e-06,
      //     9.658914977610493e-06,
      //     9.854714405441477e-06,
      //     1.007301342054994e-05,
      //     1.0284175118835049e-05,
      //     1.0490981195071054e-05,
      //     1.0679300742261095e-05,
      //     1.0892228859389378e-05,
      //     1.110290826569321e-05,
      //     1.1301678178240945e-05,
      //     1.150137015589738e-05,
      //     1.167993093709746e-05,
      //     1.1893851982624922e-05,
      //     1.2137571156328744e-05,
      //     1.2349437003296456e-05,
      //     1.2592756996927932e-05,
      //     1.2800007723547844e-05,
      //     1.3000232617790863e-05,
      //     1.318622940521188e-05,
      //     1.3413900411672668e-05,
      //     1.3667393932493306e-05,
      //     1.3861270128763902e-05,
      //     1.4079712601141529e-05,
      //     1.427516850643987e-05,
      //     1.4457135799917273e-05,
      //     1.463431915579769e-05,
      //     1.4852858947996672e-05,
      //     1.50849781624405e-05,
      //     1.529205700121172e-05,
      //     1.5475813443139253e-05,
      //     1.569477661237553e-05,
      //     1.593327877691762e-05,
      //     1.617823302397543e-05,
      //     1.637405391783169e-05,
      //     1.6561873363267655e-05,
      //     1.681820369640885e-05,
      //     1.7052805671297223e-05,
      //     1.7241497925802857e-05,
      //     1.7433759892505278e-05,
      //     1.7671044354887643e-05,
      //     1.7903068852594993e-05,
      //     1.8112427880771655e-05,
      //     1.833294591522167e-05,
      //     1.853875935676096e-05,
      //     1.8699640169703826e-05,
      //     1.8908845333335482e-05,
      //     1.9093081681992494e-05,
      //     1.932091799957431e-05,
      //     1.9520088097815707e-05,
      //     1.9779805666916765e-05,
      //     1.9954842702139914e-05
      //   ]
      // }

      // console.log("error?");
      
      // handleGetSim(content.name, setSimData)
      return <SDSimulation data={simData} />
    }
    return <pre><code class={className}>INVALID FORMAT</code></pre>
  }


  // Acutal Compoenent
  return (
    <div>
      <button id="1" type="button" onClick={handleGetTutorial}>Lesson 1</button>
      <button id="2" type="button" onClick={handleGetTutorial}>Lesson 2</button>
      <button id="3" type="button" onClick={handleGetTutorial}>Lesson 3</button>
      <ReactMarkdown components={{ code: codeblockRender }}>{tutorial}</ReactMarkdown>
    </div>
  );
}

export default Tutorial;
